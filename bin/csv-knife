#!/usr/bin/env python3
"""Melt a CSV table across a column.
"""

import argparse
import logging

import petl


def main():
    logging.basicConfig(level=logging.INFO, format="%(levelname)-8s: %(message)s")
    parser = argparse.ArgumentParser(description=__doc__.strip())
    parser.add_argument("filename", help="CSV filename to process")

    parser.add_argument('-m', '--melt', action='store', metavar="COLUMN",
                        help="Melt the output around this column")

    parser.add_argument('-t', '--transpose', action='store_true',
                        help="Transport the table")

    args = parser.parse_args()

    table = petl.fromcsv(args.filename)

    if args.melt:
        table = table.melt(args.melt)
    if args.transpose:
        table = table.transpose()
    table.tocsv(petl.StdoutSource())


if __name__ == "__main__":
    main()
